library(sf)
library(stars)







ROI = function( stri = "[117.83526716151925, 15.49233818000526],
          [117.83526716151925, 6.486174330165204],
          [129.74444684901925, 6.486174330165204],
          [129.74444684901925, 15.49233818000526]"){
  
  for (i in 1:40) {
    stri =   stringr::str_replace(stri, "\\[","c(")
    stri =     stringr::str_replace(stri,"\\]","\\)")
    stri =     stringr::str_replace(stri, "\n"," ")
  }
  
  stri =  paste0("list(",stri,")")
  
  stri = eval(parse(text = stri))
  
  ROI = rgee::ee$Geometry$Polygon(stri)
  
  return(ROI)
}





nysb = ROI("[-72.03960826310056, 41.69081941198146],
          [-74.3002772464209, 41.213841474690376],
          [-76.01306345858971, 39.828756589183456],
          [-75.7718196318592, 37.93162601717418],
          [-74.27876536800906, 37.23548230201862],
          [-72.23655834182257, 39.014371114367364],
          [-71.68760749836456, 39.50737039866158],
          [-70.89715697186095, 39.65965165797125],
          [-69.57975169415818, 39.693443031313336],
          [-69.09752406819295, 39.929632258585386],
          [-68.87870649911753, 40.23188637321017],
          [-68.90136363361137, 40.599377588764156],
          [-68.9456644683961, 41.01459231654589],
          [-69.03350458210606, 41.60848812375175],
          [-69.25296485796211, 41.95246102679075],
          [-69.53827897598087, 41.968764067213215],
          [-69.91114830962319, 42.00140459314225],
          [-70.37134482295443, 41.98516191205429],
          [-70.67800601932738, 41.919970861896395]")



visP = list(min= -2.0,max= 24.0,
            palette= c('#005aff', '#43c8c8','#77DD77', '#fff700', '#ff0000', "#B42222")
)



for (i in 1:12) {

  data = ee$ImageCollection('NASA/OCEANDATA/MODIS-Terra/L3SMI')$
    filter(ee$Filter$calendarRange(2011,2021,'year'))$filter(ee$Filter$calendarRange(i,i,'month'))$
    filterBounds(nysb)$
    select("chlor_a")$mean()
  
  ee_as_rast(image = data, region = nysb, dsn = paste0("MODIS","_chlor","_2010-2021_",i), scale = 4616 )
  
}











